# Unity 2D 플랫포머/생존 게임 전체 프로젝트 진도

## 📅 프로젝트 개요
- **프로젝트명**: 2D Claude MCP
- **Unity 버전**: 6000.0.41f1
- **장르**: 2D 플랫포머/생존 게임
- **개발 시작**: 2025년 01월 23일

## 🎯 프로젝트 특징
- 4명의 농부 캐릭터 (각자 고유 특성)
- 3슬롯 세이브/로드 시스템
- 낮/밤 사이클과 감염 시스템
- Unity MCP 통합으로 에디터 직접 제어
- 특성 시스템 (전투형, 생산형, 연구형, 균형형)

---

## 📋 완료된 주요 시스템들

### ✅ 1. 프로젝트 초기 설정 및 구조
**작업 일자**: 프로젝트 시작 시점

**완성된 기본 구조**:
- Unity 2D 프로젝트 설정 (URP 17.0.4)
- New Input System 1.13.1 통합
- Unity MCP (`com.coplaydev.unity-mcp`) 통합
- BigManJD Platformer Tileset 애셋 통합
- Undead Survivor 스프라이트 애셋 (4명 농부 캐릭터)

### ✅ 2. 코어 게임 시스템 아키텍처
**작업 일자**: 프로젝트 초기

#### SaveSystem (세이브 시스템)
**파일**: `Assets/Scripts/Save/SaveSystem.cs`
- **기능**: 3슬롯 JSON 기반 세이브/로드 시스템
- **저장 위치**: `%USERPROFILE%\AppData\LocalLow\DefaultCompany\2d Claude MCP\Saves`
- **특징**:
  - 이벤트 기반 슬롯 업데이트 (`OnSaveSlotsUpdated`)
  - 자동 슬롯 검증 및 빈 슬롯 생성
  - 예외 처리 및 안전한 파일 I/O

#### SaveData (데이터 구조)
**파일**: `Assets/Scripts/Save/SaveData.cs`
- **포함 데이터**:
  - 플레이어 정보 (이름, 캐릭터 인덱스, 위치)
  - 캐릭터 스탯 (레벨, 경험치, 체력)
  - 특성 시스템 (3가지 특성 포인트 + 가용 포인트)
  - 게임 진행 (일수, 시간, 낮/밤 상태)
  - 자원 및 인벤토리 (돈, SerializableDictionary 기반)
  - 좀비화된 캐릭터 데이터
  - 메타 정보 (저장 시간, 슬롯명, 빈 슬롯 여부)

#### GameManager (게임 관리)
**파일**: `Assets/Scripts/Managers/GameManager.cs`
- **기능**:
  - 중앙 게임 상태 관리 (일시정지/재개, 낮/밤 사이클)
  - 세이브 슬롯 협력 및 퀵 세이브 (F5 키)
  - 씬 전환 관리
  - 플레이어 참조 관리
- **패턴**: DontDestroyOnLoad 싱글톤

### ✅ 3. 플레이어 컨트롤 시스템
**작업 일자**: 프로젝트 초기

#### PlayerController (플레이어 제어)
**파일**: `Assets/Scripts/Player/PlayerController.cs`
- **기능**:
  - 2D 플랫포머 이동 (Rigidbody2D 물리)
  - New Input System 통합 + 레거시 입력 폴백
  - 캐릭터 스프라이트 관리 (4명 농부)
  - 마우스 기반 스프라이트 좌우 반전
  - 자동 세이브 데이터 로딩 및 위치 복원
- **입력 처리**:
  - 주 시스템: PlayerInput 컴포넌트 + 액션 참조
  - 폴백: Input.GetAxisRaw() 레거시 입력
  - 마우스: 별도 처리 (Input System 미사용)

#### CharacterData (캐릭터 데이터)
**파일**: `Assets/Scripts/Player/CharacterData.cs`
- **ScriptableObject 기반 캐릭터 설정**:
  - 캐릭터 정보 (이름, 인덱스)
  - 비주얼 (스프라이트, 애니메이터 컨트롤러)
  - 스탯 (이동속도, 점프력, 최대 체력)
  - 특성 (전투형, 생산형, 연구형)
  - 시작 장비

### ✅ 4. UI 시스템
**작업 일자**: 프로젝트 초기

#### MainMenuUI (메인 메뉴)
**파일**: `Assets/Scripts/UI/MainMenuUI.cs`
- **기능**:
  - 메인 메뉴 네비게이션
  - 3슬롯 세이브 슬롯 관리 UI
  - 설정 패널 (마스터 볼륨, SFX 볼륨)
  - 캐릭터 선택 UI (4명 농부)
  - 오디오 시스템 (버튼 클릭 사운드)
- **패널 관리**:
  - 메인 메뉴 ↔ 세이브 슬롯 ↔ 캐릭터 선택 ↔ 설정
  - 이벤트 기반 세이브 슬롯 UI 업데이트

### ✅ 5. 씬 구조
**작업 일자**: 프로젝트 초기

- **MainScene.unity**: 메인 메뉴 및 캐릭터 선택
- **GameScene.unity**: 주요 게임플레이 씬
- **SampleScene.unity**: 원본 데모 씬

### ✅ 6. 애니메이션 시스템 (최신 완료)
**작업 일자**: 2025년 01월 23일

#### PlayerAnimationController (애니메이션 제어)
**파일**: `Assets/Scripts/Player/PlayerAnimationController.cs`
- **기능**:
  - 이동 상태 자동 감지 및 애니메이션 전환
  - 동적 애니메이터 컨트롤러 교체
  - 지면 감지 및 수직 속도 파라미터
  - 애니메이션 이벤트 핸들링
- **파라미터**:
  - `IsMoving` (Bool): 이동 상태
  - `IsGrounded` (Bool): 지면 접촉 상태
  - `VerticalSpeed` (Float): 수직 속도

#### 캐릭터별 애니메이션 시스템
**파일 위치**: `Assets/Animation/FarmerX/`

**Farmer0 (생산형)**:
- `Farmer0_AnimatorController`
- `Farmer0_Idle.anim` (대기 애니메이션)
- `Farmer0_Run.anim` (달리기 애니메이션)

**Farmer1 (전투형)**:
- `Farmer1_AnimatorController`
- `Farmer1_Idle.anim`
- `Farmer1_Run.anim`

**Farmer2 (연구형)**:
- `Farmer2_AnimatorController`
- `Farmer2_Idle.anim`
- `Farmer2_Run.anim`

**Farmer3 (균형형)**:
- `Farmer3_AnimatorController`
- `Farmer3_Idle.anim`
- `Farmer3_Run.anim`

#### PlayerController 애니메이션 통합
**확장된 기능**:
- `characterAnimators` 배열 추가 (RuntimeAnimatorController[4])
- `SetCharacterSprite()` 메서드 확장 - 애니메이터 동적 교체
- 캐릭터 선택 시 스프라이트 + 애니메이터 동시 적용

---

## 🔧 전체 시스템 아키텍처

### 싱글톤 패턴
- **GameManager**: 게임 상태 및 씬 관리
- **SaveSystem**: 데이터 영속성 관리
- 둘 다 DontDestroyOnLoad로 씬 전환 시 유지

### 데이터 흐름
```
캐릭터 선택 (MainMenuUI)
    ↓
SaveSystem.CreateNewGameData() 또는 LoadGame()
    ↓
PlayerPrefs에 현재 슬롯 저장
    ↓
GameScene 로드
    ↓
PlayerController.LoadPlayerData()
    ↓
SetCharacterSprite() → 스프라이트 + 애니메이터 설정
    ↓
PlayerAnimationController가 자동 애니메이션 관리
```

### 입력 시스템 계층
1. **New Input System** (주 시스템)
   - PlayerInput 컴포넌트
   - Input Actions 애셋 기반
   - 액션 맵: Player, UI

2. **레거시 Input** (폴백)
   - Input.GetAxisRaw() 사용
   - 하위 호환성 보장

3. **마우스 입력** (별도)
   - 캐릭터 방향 제어용
   - Input.mousePosition 직접 사용

---

## 📁 전체 프로젝트 구조

```
Assets/
├── Animation/                      # 애니메이션 시스템
│   ├── Farmer0/
│   ├── Farmer1/
│   ├── Farmer2/
│   └── Farmer3/
├── BigManJD/                      # 2D 플랫포머 타일셋
│   └── Platformer Tileset - Pixelart Grasslands/
├── Scripts/                       # 모든 C# 스크립트
│   ├── Managers/
│   │   └── GameManager.cs
│   ├── Player/
│   │   ├── CharacterData.cs
│   │   ├── PlayerAnimationController.cs
│   │   ├── PlayerController.cs
│   │   └── PlayerController_V2.cs
│   ├── Save/
│   │   ├── SaveData.cs
│   │   └── SaveSystem.cs
│   └── UI/
│       ├── MainMenuUI.cs
│       └── MainMenuUI_TMP.cs
├── Scenes/                        # 씬 파일들
│   ├── GameScene.unity
│   ├── MainScene.unity
│   └── SampleScene.unity
├── TextMesh Pro/                  # TextMeshPro 애셋
├── Undead Survivor/               # 캐릭터 스프라이트
│   └── Sprites/
│       ├── Farmer 0.png
│       ├── Farmer 1.png
│       ├── Farmer 2.png
│       └── Farmer 3.png
└── [생성된 애셋 데이터 파일들]
```

---

## 🎮 구현된 게임플레이 기능

### 캐릭터 시스템
- [x] 4명의 고유 농부 캐릭터 (각기 다른 특성)
- [x] 캐릭터별 개별 애니메이션 (Idle, Run)
- [x] 캐릭터 선택 시 자동 스프라이트/애니메이터 적용
- [x] 마우스 방향 기반 캐릭터 좌우 반전

### 이동 및 애니메이션
- [x] 2D 플랫포머 이동 (물리 기반)
- [x] 자동 애니메이션 전환 (이동 시 Run, 정지 시 Idle)
- [x] 지면 감지 시스템
- [x] 점프 기능

### 데이터 관리
- [x] 3슬롯 세이브/로드 시스템
- [x] JSON 기반 데이터 직렬화
- [x] 플레이어 위치 및 상태 저장
- [x] 캐릭터별 특성 데이터 관리
- [x] 인벤토리 시스템 (Dictionary 기반)

### UI 시스템
- [x] 메인 메뉴 네비게이션
- [x] 세이브 슬롯 관리 UI
- [x] 캐릭터 선택 인터페이스
- [x] 설정 메뉴 (볼륨 조절)
- [x] 게임 일시정지 (ESC 키)
- [x] 퀵 세이브 (F5 키)

### 게임 상태 관리
- [x] 씬 전환 시스템
- [x] 게임 일시정지/재개
- [x] 낮/밤 사이클 기반 데이터
- [x] 감염 시스템 데이터 구조

---

## 🗺️ 오픈월드 맵 시스템 계획 (신규 추가)

### 하이브리드 맵 시스템 아키텍처
**작업 예정일**: 다음 개발 세션

#### 시스템 구조
```
WorldManager (최상위 맵 관리)
├── ChunkManager (청크 로딩/언로딩)
├── TilemapLayers (타일맵 레이어 관리)
├── BiomeGenerator (바이옴별 자동 생성)
├── PrefabPlacer (수동 제작 구조물 배치)
└── PlayerTracker (플레이어 위치 추적)
```

#### 청크 시스템 설계
- **청크 크기**: 32x32 타일
- **로딩 범위**: 플레이어 중심 3x3 청크 (9개)
- **언로딩**: 플레이어에서 일정 거리 이상 떨어진 청크
- **데이터 구조**: ChunkData (위치, 타일 데이터, 오브젝트 데이터, 수정 상태)

#### 타일맵 레이어 구조
```
Grid GameObject
├── BackgroundTilemap (배경)
├── GroundTilemap (지면 + 콜라이더)
├── WallTilemap (벽/장애물 + 콜라이더)
├── DecorationTilemap (장식)
└── CollisionTilemap (투명 콜라이더)
```

#### 하이브리드 생성 방식
**수동 제작 영역**:
- 스폰 지점 (안전 지대)
- 주요 거점 및 마을
- 특별 던전 및 보스 지역
- 스토리 관련 중요 지역

**자동 생성 영역**:
- 일반 필드 (Perlin Noise 기반)
- 바이옴별 특화 지역 (평원, 숲, 폐허, 산악)
- 무한 확장 가능한 탐험 지역

#### 바이옴 시스템
- **평원**: 농업 최적화, 낮은 위험도, 기본 자원
- **숲**: 목재 자원, 중간 위험도, 은신처
- **폐허**: 고급 자원, 높은 좀비 밀도, 건설 재료
- **산악**: 광물 자원, 동굴 시스템, 방어 지형

#### 성능 최적화 전략
- 청크별 동적 로딩/언로딩으로 메모리 관리
- 타일맵 콜라이더 최적화 (Composite Collider2D)
- 오브젝트 풀링 (적, 아이템, 이펙트)
- Sprite Atlas를 통한 드로우 콜 감소

---

## 🚀 향후 확장 계획

### 단기 목표 (다음 세션들)
- [ ] **오픈월드 맵 시스템 구현** (최우선)
  - [ ] ChunkManager 및 ChunkData 스크립트
  - [ ] 타일맵 레이어 구조 설정
  - [ ] 기본 청크 로딩/언로딩 시스템
  - [ ] 플레이어 이동에 따른 동적 맵 로딩
- [ ] 점프/낙하 애니메이션 추가
- [ ] 공격 시스템 및 애니메이션
- [ ] 적 캐릭터 시스템
- [ ] 아이템 수집 시스템

### 중기 목표
- [ ] 낮/밤 사이클 구현
- [ ] 감염 시스템 게임플레이
- [ ] 건설/크래프팅 시스템
- [ ] 좀비화된 캐릭터 시스템
- [ ] 스킬 트리 UI

### 장기 목표
- [ ] 멀티플레이어 지원
- [ ] 절차적 맵 생성
- [ ] 모바일 플랫폼 포팅
- [ ] 더 많은 캐릭터 및 직업

---

## 🧪 테스트 완료 사항

### 기본 기능
- [x] 프로젝트 빌드 및 실행
- [x] 모든 씬 간 전환
- [x] 세이브/로드 동작
- [x] 캐릭터 선택 및 게임플레이

### 애니메이션 시스템
- [x] 4명 캐릭터 개별 애니메이션
- [x] 자동 애니메이션 전환
- [x] 캐릭터 교체 시 애니메이터 적용
- [x] 이동/정지 상태 감지

### 데이터 시스템
- [x] 3슬롯 모두 정상 동작
- [x] 데이터 무결성 검증
- [x] 파일 I/O 예외 처리
- [x] 크로스 씬 데이터 유지

---

## 📝 개발 노트 및 주의사항

### Unity MCP 통합
- MCP 도구를 사용한 Unity 에디터 직접 제어
- 스크립트 생성, GameObject 관리, 씬 관리 자동화
- `mcp__UnityMCP__*` 함수들로 Unity 작업 수행

### 코딩 패턴 및 컨벤션
- 싱글톤 패턴: DontDestroyOnLoad + Instance 패턴
- 이벤트 기반 UI 업데이트: `OnSaveSlotsUpdated` 등
- SerializableDictionary로 Unity 직렬화 지원
- 방어적 프로그래밍: null 체크 및 예외 처리

### 애니메이션 설정 권장값
- **Idle 애니메이션**: Sample Rate 8-12 (느린 대기)
- **Run 애니메이션**: Sample Rate 12-16 (빠른 달리기)
- **모든 애니메이션**: Loop Time 활성화 필수

### 파일 구조 주의사항
- 스프라이트 위치: `Assets/Undead Survivor/Sprites/`
- 애니메이션 파일: `Assets/Animation/FarmerX/`
- 스크립트 구조: 기능별 폴더 분리 유지

---

## 📊 현재 프로젝트 상태

**전체 진행률**: 약 40-50% (기본 시스템 완료)

### 완료된 핵심 시스템
✅ **데이터 관리** (100%)
✅ **플레이어 컨트롤** (100%)
✅ **애니메이션 시스템** (100%)
✅ **UI 기본 구조** (100%)
✅ **씬 관리** (100%)

### 진행 중/예정 시스템
🔄 **게임플레이 메커니즘** (30%)
⏳ **전투 시스템** (0%)
⏳ **인벤토리/아이템** (20%)
⏳ **환경 시스템** (10%)
⏳ **사운드 시스템** (10%)

---

**최종 업데이트**: 2025년 01월 23일
**다음 세션 권장 작업**: 점프/낙하 애니메이션 추가 또는 기본 전투 시스템 구현
**중요**: 이 문서를 참고하여 현재 구조를 파악하고 기존 패턴을 유지하며 개발 진행